{% extends "base_generic.html" %}

{% block content %}
{% load static %}

{% if banner %}
<div class="banner">
<div class="banner_img">
{% load static %}
<a href="{% url 'banner-click' banner.pk %}"><img src = "{{ banner.image.url }}"></a>
</div>
<div class="banner_content">
<div>
<h1>{{banner.title}}</h1>
<p>{{banner.text}}</p>
</div>
<div>
<div class="link banner_btn"><a href="{% url 'banner-click' banner.pk %}">Quick View</a></div>
</div>
</div>
</div>  
 {% else %}
 <div></div>
{% endif %}
<div class="table_btn_promo tab_fil">{{banner_left.text}}</div>

		<ul>
          TOP:
		  <li><a href="{% url 'news' %}day/"  >-DAY-  </a></li>
		  <li><a href="{% url 'news' %}week/" >-WEEK- </a></li>
          <li><a href="{% url 'news' %}month/">-MONTH-</a></li>	
		  <li><a href="{% url 'news' %}"      >-ALL-  </a></li>
		</ul>
<div class="table_btn_promo tab_fil" style="float: right;">{{banner_right.text}}</div>
{% if allnews %}
	<table id="user_list">
	<thead>
	<tr>
		<th>COIN</th>
		<th>SOURCE</th>
		<th>NEWS</th>
		<th style="width: 11%;">CREATED TIME</th>
		<th>DIRECTION</th>
		<th style="width: 10%;">RATING</th>
		<th style="width: 10%;">REAL</th>
		<th style="width: 10%;">FAKE</th>
		<th>NEWS PRICE</th>

	</tr>
	</thead>
	<tbody class="infinite-container">
	
	{% for news in allnews %}
	{% if news.promo_status == 'y' %}<tr style="font-weight:bold" class="infinite-item tab_pro" >{% else %}<tr class="infinite-item tab_fon">{% endif %} 
		<td class="td_pd"style="width: 10%;">
		<img src="{{news.coinid.image.url}}" style="border-radius: 100%; width: 77px;padding-top: 6px;">
		<h3>{{news.coinid}}</h3>
        <p class="price_change">{{news.coinid.price|floatformat:3}}$
		({{news.coinid.change|floatformat:1}}%)</p>		
		</td>
		<td class="td_pd" style="width: 10%;">{{news.sourceid}}</td>
		<td class="td_pd ria"style="width: 45%;">
		<p class="duration_change_2">DURATION TIME OF NEWS: {{news.duration}}</p>
		<a href="{{ news.get_absolute_url }}">
		<h4>{{news.title}}</h4></a>
		<div class="textnews_2"><p>{{news.text|truncatechars:245}}</p></div>
		{%if news.link %}<a href="{% url 'news-click' news.pk %}" class="rt">{{ news.link|truncatechars:100}}</a><p class="click_count">count of clicks on link: 
		{{ news.count_link_click }}</p>{% endif %}
		</td>
		
		<td class="td_pd" style="width: 11%;">{{news.time|date:"d M Y"}}<br>{{news.time|time:"H:i"}}</</td>
		<td class="td_pd">{% if news.direction == 'b' %}<img src="{% static 'images/UP_news.png' %}" style="vertical-align: top;">{% elif news.direction == 's' %}<img src="{% static 'images/D2l.png' %}" style="vertical-align: top;">{% endif %}</td>
		<td class="td_pd" style="width: 10%;">{{news.rating}}</td>
		<td style="width: 10%;    text-align: center;     padding: 0px 16px;"><p  id="like_count_{{news.newsid}}">{{news.like}}</p>
		{% if user.is_authenticated %}
		
		
			{% if news.enable_vote %}
		<div id="like_btn_{{news.newsid}}" data-newsid="{{news.newsid}}" data-url="{% url 'news-like-ajax' %}"  class="like_btn" onclick="like(this)"><p>VOTE</p></div>
				{% endif %}
		
		
		{% endif %}

        <p> REAL</p>		
		</td>
		
		<td style="width: 10%;    text-align: center;     padding: 0px 16px;"><p id="dislike_count_{{news.newsid}}">{{news.dislike}}</p>
		
		{% if user.is_authenticated %}
			{% if news.enable_vote %}
				<div id="dislike_btn_{{news.newsid}}" data-newsid="{{news.newsid}}" data-url="{% url 'news-dislike-ajax' %}"  class="dislike_btn" onclick="dislike(this)"><p>VOTE</p></div>
			{% endif %}
		{% endif %}
		<p>FAKE</p>
		</td>
		<td>{{news.coinprice|floatformat:3}}</td>
	</tr>
	{% endfor %}
	</tbody>
	</table>
	  {% if allnews.has_next %}
    <a class="infinite-more-link" href="?page={{ allnews.next_page_number}}&coin={{rget.coin}}&source={{rget.source}}&date={{rget.date}}&direction={{rget.direction}}">More</a>
  {% endif %}

    <div class="loading" style="display: none;">
    Loading...
  </div>
{% endif %} 

<script type="text/javascript">
$('.like_btn').click(function(){
    var newsid;
    newsid = $(this).attr("data-newsid");
	url = $(this).attr("data-url");
    $.get(url, {news_id: newsid}, function(data){
               $('#like_count_'+newsid).html(data);
               $('#like_btn_'+newsid).hide();
			   $('#dislike_btn_'+newsid).hide();
    });
});
$('.dislike_btn').click(function(){
    var newsid;
    newsid = $(this).attr("data-newsid");
	url = $(this).attr("data-url");
    $.get(url, {news_id: newsid}, function(data){
               $('#dislike_count_'+newsid).html(data);
               $('#like_btn_'+newsid).hide();
			   $('#dislike_btn_'+newsid).hide();
    });
});
</script>
		  <script>
    var infinite = new Waypoint.Infinite({
      element: $('.infinite-container')[0],
      onBeforePageLoad: function () {
        $('.loading').show();
		console.log('before pageLoad ajax');
				
      },
      onAfterPageLoad: function ($items) {
        $('.loading').hide();
		$("#user_list").trigger("update");
		console.log('after pageLoad ajax');
					
      },
	  
    });
	</script>
{% endblock %}

